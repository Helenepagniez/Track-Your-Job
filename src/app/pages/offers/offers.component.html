<div class="offers-container">
    <div class="page-header">
        <h2>Mes Offres</h2>
        <button class="btn btn-primary" (click)="openAddModal()">
            <span>+</span> Ajouter une offre
        </button>
    </div>

    <div class="filters-bar glass">
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Rechercher une offre..." class="search-input" [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)">
        </div>
        <div class="filter-options">
            <select class="form-select" [ngModel]="statusFilter()" (ngModelChange)="statusFilter.set($event)">
                <option value="">Tous les statuts</option>
                <option value="To Apply">√Ä postuler</option>
                <option value="Applied">En attente</option>
                <option value="Interview">Entretien</option>
                <option value="Offer">Offre re√ßue</option>
                <option value="Rejected">Refus√©</option>
            </select>
        </div>
    </div>

    <div class="offers-grid">
        <div class="card offer-card" *ngFor="let offer of filteredOffers(); let i = index">
            <div class="offer-header">
                <div class="company-logo">{{ offer.company.charAt(0) }}</div>
                <div class="offer-main-info">
                    <h3>{{ offer.title }}</h3>
                    <p class="company-name">{{ offer.company }}</p>
                </div>
                <div class="offer-actions">
                    <button mat-icon-button [matMenuTriggerFor]="offerMenu" class="menu-trigger">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                    <mat-menu #offerMenu="matMenu">
                        <button mat-menu-item (click)="openAddModal(offer)" class="modify-btn">
                            <i class="fa-solid fa-pen"></i>
                            <span>Modifier</span>
                        </button>
                        <button mat-menu-item (click)="confirmDelete(offer.id)" class="delete-btn">
                            <i class="fa-solid fa-trash-can"></i>
                            <span>Supprimer</span>
                        </button>
                    </mat-menu>
                </div>
            </div>

            <div class="offer-details">
                <div class="detail-item">
                    <i class="icon">üìç</i> {{ offer.location }}
                </div>
                <div class="detail-item" *ngIf="offer.salary">
                    <i class="icon">üí∞</i> {{ offer.salary }}
                </div>
                <div class="detail-item">
                    <i class="icon">üìÖ</i> {{ offer.dateAdded | date:'dd MMM yyyy' }}
                </div>
            </div>

            <div class="offer-footer">
                <span class="status-badge" [style.background-color]="statusColors[offer.status] + '20'"
                    [style.color]="statusColors[offer.status]">
                    {{ getStatusLabel(offer.status) }}
                </span>
                <button class="btn btn-outline btn-sm" (click)="viewDetails(offer.id)">Voir d√©tails</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Offer Modal -->
<div class="modal-overlay" *ngIf="showAddModal()" (click)="closeAddModal()">
    <div class="modal-content stepper-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>{{ editingOffer() ? 'Modifier l\'offre' : 'Ajouter une offre' }}</h3>
            <button class="close-btn" (click)="closeAddModal()">√ó</button>
        </div>
        <div class="modal-body">
            <app-offer-form [offer]="editingOffer()" (save)="onSaveOffer($event)" (cancel)="closeAddModal()">
            </app-offer-form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm()" (click)="cancelDelete()">
    <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Supprimer l'offre ?</h3>
            <button class="close-btn" (click)="cancelDelete()">√ó</button>
        </div>
        <div class="modal-body">
            <p>√ätes-vous s√ªr de vouloir supprimer cette offre ? Cette action est irr√©versible.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" (click)="cancelDelete()">Annuler</button>
            <button class="btn btn-danger" (click)="deleteOffer()">Supprimer</button>
        </div>
    </div>
</div>