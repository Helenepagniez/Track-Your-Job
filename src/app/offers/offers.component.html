<div class="offers-container">
    <div class="page-header">
        <h1>Mes Offres</h1>
        <button class="btn btn-primary" (click)="openAddModal()" title="Ajouter une nouvelle offre">
            <span>+</span> Ajouter une offre
        </button>
    </div>

    <div class="filters-bar glass">
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Rechercher une offre..." class="search-input" [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)">
        </div>
        <div class="filter-options">
            <select class="form-select" [class.select-to-apply]="statusFilter() === 'To Apply'"
                [class.select-applied]="statusFilter() === 'Applied'"
                [class.select-to-relaunch]="statusFilter() === 'To Relaunch'"
                [class.select-no-response]="statusFilter() === 'No Response'"
                [class.select-interview]="statusFilter() === 'Interview'"
                [class.select-offer]="statusFilter() === 'Offer'"
                [class.select-rejected]="statusFilter() === 'Rejected'" [ngModel]="statusFilter()"
                (ngModelChange)="statusFilter.set($event)">
                <option value="" class="status-option-default">Tous les statuts</option>
                <option value="To Apply" class="status-option status-to-apply">√Ä postuler</option>
                <option value="Applied" class="status-option status-applied">En attente</option>
                <option value="To Relaunch" class="status-option status-to-relaunch">√Ä relancer</option>
                <option value="No Response" class="status-option status-no-response">Sans r√©ponse</option>
                <option value="Interview" class="status-option status-interview">Entretien</option>
                <option value="Offer" class="status-option status-offer">Offre re√ßue</option>
                <option value="Rejected" class="status-option status-rejected">Refus√©</option>
            </select>
        </div>
    </div>

    <div class="offers-grid">
        <div class="card offer-card" *ngFor="let offer of filteredOffers(); let i = index">
            <div class="offer-header">
                <div class="company-logo">{{ offer.company.charAt(0) }}</div>
                <div class="offer-main-info">
                    <h3>{{ offer.title }}</h3>
                    <p class="company-name">{{ offer.company }}</p>
                </div>
                <div class="offer-actions">
                    <button mat-icon-button [matMenuTriggerFor]="offerMenu" class="menu-trigger" title="Options">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                    <mat-menu #offerMenu="matMenu">
                        <button mat-menu-item (click)="openAddModal(offer)" class="modify-btn" title="Modifier l'offre">
                            <i class="fa-solid fa-pen"></i>
                            <span>Modifier</span>
                        </button>
                        <button mat-menu-item (click)="confirmDelete(offer.id)" class="delete-btn"
                            title="Supprimer l'offre">
                            <i class="fa-solid fa-trash-can"></i>
                            <span>Supprimer</span>
                        </button>
                    </mat-menu>
                </div>
            </div>

            <div class="offer-details">
                <div class="detail-item">
                    <i class="icon">üìç</i> {{ offer.location }}
                </div>
                <div class="detail-item" *ngIf="offer.salary">
                    <i class="icon">üí∞</i> {{ offer.salary }}
                </div>
            </div>

            <div class="offer-footer">
                <span class="status-badge" [style.background-color]="statusColors[offer.status].background"
                    [style.color]="statusColors[offer.status].color" [style.border]="statusColors[offer.status].border">
                    {{ getStatusLabel(offer.status) }}
                </span>
                <button class="btn btn-outline btn-sm" (click)="viewDetails(offer.id)"
                    title="Voir les d√©tails de l'offre">Voir d√©tails <i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="offers().length === 0" class="empty-state">
        <div class="empty-icon">
            <i class="fa-solid fa-briefcase"></i>
        </div>
        <h3>Aucune offre trouv√©e</h3>
        <p>Essayez de modifier votre recherche ou ajoutez de nouvelles offres.</p>
    </div>
</div>

<!-- Add/Edit Offer Modal -->
<div class="modal-overlay" *ngIf="showAddModal()">
    <div class="modal-content stepper-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>{{ editingOffer() ? 'Modifier l\'offre' : 'Ajouter une offre' }}</h3>
            <button class="close-btn" (click)="closeAddModal()" title="Fermer">√ó</button>
        </div>
        <div class="modal-body">
            <app-offer-form [offer]="editingOffer()" (save)="onSaveOffer($event)" (cancel)="closeAddModal()">
            </app-offer-form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm()">
    <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Supprimer l'offre ?</h3>
            <button class="close-btn" (click)="cancelDelete()" title="Fermer">√ó</button>
        </div>
        <div class="modal-body-confirm">
            <p>√ätes-vous s√ªr de vouloir supprimer cette offre ? Cette action est irr√©versible.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" (click)="cancelDelete()" title="Annuler la suppression">Annuler</button>
            <button class="btn btn-danger" (click)="deleteOffer()" title="Confirmer la suppression">Supprimer</button>
        </div>
    </div>
</div>