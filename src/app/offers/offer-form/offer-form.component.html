<div class="stepper-container">
    <mat-stepper [linear]="true" #stepper>
        <!-- Step 1: Infos G√©n√©rales -->
        <mat-step [stepControl]="firstFormGroup">
            <form [formGroup]="firstFormGroup">
                <ng-template matStepLabel>Infos G√©n√©rales</ng-template>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Titre du poste *</label>
                        <input matInput formControlName="title" placeholder="Ex: D√©veloppeur Angular" required
                            class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Entreprise *</label>
                        <input matInput formControlName="company" placeholder="Ex: Google" required class="form-control"
                            [matAutocomplete]="auto">
                        <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngFor="let company of filteredCompanies()" [value]="company">
                                {{company}}
                            </mat-option>
                        </mat-autocomplete>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Type de contrat</label>
                        <select formControlName="contractType" class="form-control">
                            <option value="CDI">CDI</option>
                            <option value="CDD">CDD</option>
                            <option value="Freelance">Freelance</option>
                            <option value="Stage">Stage</option>
                            <option value="Alternance">Alternance</option>
                            <option value="Int√©rim">Int√©rim</option>
                        </select>
                    </div>

                    <ng-container
                        *ngIf="['CDD', 'Stage', 'Freelance', 'Int√©rim'].includes(firstFormGroup.get('contractType')?.value)">
                        <div class="form-group">
                            <label class="form-label">Dur√©e du contrat *</label>
                            <input matInput formControlName="contractDuration" placeholder="Ex: 6 mois"
                                class="form-control">
                        </div>
                    </ng-container>

                    <div class="form-group">
                        <label class="form-label">Dur√©e hebdomadaire</label>
                        <input matInput formControlName="weeklyHours" placeholder="Ex: 35h" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lieu</label>
                        <input matInput formControlName="location" placeholder="Ex: Paris / Remote"
                            class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Salaire</label>
                        <input matInput formControlName="salary" placeholder="Ex: 45k - 55k" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lien de l'annonce</label>
                        <input matInput formControlName="link" placeholder="https://..." class="form-control">
                    </div>
                </div>

                <div class="stepper-actions">
                    <button mat-button matStepperNext type="button" class="btn btn-primary"
                        title="Passer √† l'√©tape suivante">Suivant</button>
                </div>
            </form>
        </mat-step>

        <!-- Step 2: D√©tails -->
        <mat-step [stepControl]="secondFormGroup">
            <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel>D√©tails</ng-template>

                <div class="form-group">
                    <label class="form-label">Pr√©sentation entreprise</label>
                    <textarea matInput formControlName="companyDescription" rows="3" class="form-control"
                        [readonly]="isEditing() || isExistingCompanySelected()"
                        [placeholder]="(isEditing() || isExistingCompanySelected()) ? 'Modifiable uniquement depuis la page entreprise' : 'Description de l\'entreprise...'"></textarea>
                    <small *ngIf="isEditing() || isExistingCompanySelected()"
                        style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                        üí° Pour modifier la pr√©sentation de l'entreprise, rendez-vous sur la page de l'entreprise
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label">Missions</label>
                    <textarea matInput formControlName="missions" rows="4" class="form-control"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Profil recherch√©</label>
                    <textarea matInput formControlName="profile" rows="3" class="form-control"></textarea>
                </div>

                <div class="stepper-actions">
                    <button mat-button matStepperPrevious type="button" class="btn btn-outline"
                        title="Revenir √† l'√©tape pr√©c√©dente">Retour</button>
                    <button mat-button matStepperNext type="button" class="btn btn-primary"
                        title="Passer √† l'√©tape suivante">Suivant</button>
                </div>
            </form>
        </mat-step>

        <!-- Step 3: Extras -->
        <mat-step [stepControl]="thirdFormGroup">
            <form [formGroup]="thirdFormGroup">
                <ng-template matStepLabel>Extras</ng-template>

                <div class="form-group">
                    <label class="form-label">Avantages</label>
                    <textarea matInput formControlName="benefits" rows="3" class="form-control"
                        placeholder="Tickets resto, mutuelle..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">√âtapes de recrutement</label>
                    <textarea matInput formControlName="recruitmentProcess" rows="3" class="form-control"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Autres informations</label>
                    <textarea matInput formControlName="others" rows="2" class="form-control"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Statut initial *</label>
                    <select formControlName="status" required class="form-control">
                        <option value="To Apply">√Ä postuler</option>
                        <option value="Applied">En attente</option>
                        <option value="To Relaunch">√Ä relancer</option>
                        <option value="No Response">Sans r√©ponse</option>
                        <option value="Interview">Entretien</option>
                        <option value="Offer">Offre re√ßue</option>
                        <option value="Rejected">Refus√©</option>
                    </select>
                </div>

                <div class="form-grid" *ngIf="thirdFormGroup.get('status')?.value === 'Interview'">
                    <div class="form-group">
                        <label class="form-label">Date de l'entretien *</label>
                        <mat-form-field>
                            <input matInput [matDatepicker]="pickerInterviewDate" formControlName="interviewDate" />
                            <mat-datepicker-toggle matIconSuffix [for]="pickerInterviewDate"></mat-datepicker-toggle>
                            <mat-datepicker #pickerInterviewDate></mat-datepicker>
                        </mat-form-field>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Type d'entretien *</label>
                        <select formControlName="interviewType" class="form-control">
                            <option value="Pr√©qual">Pr√©qual</option>
                            <option value="Entretien Physique">Entretien Physique</option>
                            <option value="Entretien T√©l√©phonique">Entretien T√©l√©phonique</option>
                            <option value="Entretien Visio">Entretien Visio</option>
                        </select>
                    </div>
                </div>

                <div class="stepper-actions">
                    <button mat-button matStepperPrevious type="button" class="btn btn-outline"
                        title="Revenir √† l'√©tape pr√©c√©dente">Retour</button>
                    <button mat-button (click)="submit()" type="button" class="btn btn-primary"
                        title="Enregistrer l'offre">
                        {{ isEditing() ? 'Mettre √† jour' : 'Sauvegarder' }}
                    </button>
                </div>
            </form>
        </mat-step>
    </mat-stepper>
</div>