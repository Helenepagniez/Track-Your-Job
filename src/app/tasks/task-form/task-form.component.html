<div class="modal-header">
    <h3>{{ task ? 'Modifier la Tâche' : 'Nouvelle Tâche' }}</h3>
    <button class="close-btn" (click)="onCancel()" title="Fermer">×</button>
</div>
<div class="modal-body">
    <div class="form-group">
        <label class="form-label">Titre *</label>
        <input type="text" class="form-control" [(ngModel)]="formData.title" placeholder="Ex: Relancer RH">
    </div>
    <div class="form-group">
        <label class="form-label">Date d'échéance</label>
        <mat-form-field>
            <input matInput [matDatepicker]="pickerDueDate" [ngModel]="formData.dueDate"
                (ngModelChange)="formData.dueDate = $event" />
            <mat-datepicker-toggle matIconSuffix [for]="pickerDueDate"></mat-datepicker-toggle>
            <mat-datepicker #pickerDueDate></mat-datepicker>
        </mat-form-field>
    </div>
    <div class="form-group">
        <label class="form-label">Priorité</label>
        <select class="form-control" [(ngModel)]="formData.priority">
            <option value="haute">Haute</option>
            <option value="moyenne">Moyenne</option>
            <option value="faible">Basse</option>
        </select>
    </div>
    <div class="form-group">
        <label class="form-label">Lien (optionnel)</label>
        <input type="url" class="form-control" [(ngModel)]="formData.link" placeholder="https://example.com">
    </div>
    <div class="form-group">
        <label class="form-label">Offres liées (optionnel)</label>

        <div class="chips-container" *ngIf="formData.relatedOffers && formData.relatedOffers.length > 0">
            <span class="chip" *ngFor="let offer of formData.relatedOffers; let i = index">
                {{ offer }}
                <span class="remove-chip" (click)="removeOffer(i)" title="Retirer l'offre">×</span>
            </span>
        </div>

        <div class="autocomplete-wrapper">
            <input type="text" class="form-control" [(ngModel)]="searchTerm" (ngModelChange)="onSearchInput()"
                (blur)="onBlur()" placeholder="Ex: Senior Angular Developer">

            <ul class="suggestions-list" *ngIf="showSuggestions">
                <li *ngFor="let offer of filteredOffers" (mousedown)="selectOffer(offer)">
                    {{getOfferLabel(offer)}}
                </li>
                <li *ngIf="filteredOffers.length === 0" class="no-results">
                    Aucune offre trouvée
                </li>
            </ul>
        </div>
    </div>
    <div class="form-group">
        <label class="form-label">Statut</label>
        <select class="form-control" [(ngModel)]="formData.status">
            <option value="a_faire">À faire</option>
            <option value="en_cours">En cours</option>
            <option value="termine">Terminé</option>
        </select>
    </div>
    <div class="form-actions">
        <button class="btn btn-outline" (click)="onCancel()" title="Annuler les modifications">Annuler</button>
        <button class="btn btn-primary" (click)="onSubmit()" title="Enregistrer la tâche">{{ task ? 'Mettre à jour' :
            'Ajouter' }}</button>
    </div>
</div>